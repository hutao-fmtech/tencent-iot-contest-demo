# 腾讯云Iot大赛 Demo 通信协议

### 1. 协议框架

|  命令字 | 协议版本 | 数据 |
| --- | --- | --- |
|  1 Byte |  1 Byte |  [n] Byte|

- **命令字：**标示当前命令，上行下行对半分。上行命令字 0x00 ～ 0x7F， 下行命令字 0x80 ～ 0xFF ，不同命令字对应不同动作和数据。
- **协议版本：**标示协议版本，为产品兼容考虑。此版本，固定为0x01
- **数据：**命令字携带的数据，依据协议解析。n 可以为 0 ， 即只有指令和版本，无数据。

### 2. 通信方式
设备连接腾讯云铺设的 LoRaWAN 网关，通过 LoRaWAN 协议通信。有 **状态切换** 立即上报，每隔 **10分钟** 上报一次心跳（根据应用场景可设置），数据包为 **Confirm** 包。

### 3. 命令字
#### 3.1 状态上报指令 -- 0x00
- **指令格式：**

| 命令字 | 协议版本 | 数据|
| --- | --- | --- |
|  0x00 | 0x01 | 0x01 |

- **数据解析：** 每个Bit代表一个开关状态，1 为占用，0 为空闲。有 **状态切换** 立即上报。无切换，按照**心跳周期**上报。

```
led_state = 0x01 & 0x01; // 0x01，开。
```

#### 3.2 心跳周期上报指令 -- 0x02
- **指令格式：**

| 命令字 | 协议版本 | 数据|
| --- | --- | --- |
|  0x02 | 0x01 | 0x0A |

- **数据解析：** 心跳周期值，分钟为单位。收到应用端下发的 **获取心跳周期指令（0x81）** 后，由设备端上报。

```
heartbeat_period  = 0x0A ; // 0x0A，10， 心跳周期为 10 分钟。
```

#### 3.3 获取LED状态指令 -- 0x80
- **指令格式：**

| 命令字 | 协议版本 | 
| --- | --- | 
|  0x80 | 0x01 | 

- **数据解析：** 无附加数据。由应用端下发。


#### 3.4 获取心跳周期指令 -- 0x81
- **指令格式：**

| 命令字 | 协议版本 |
| --- | --- | 
|  0x81 | 0x01 |

- **数据解析：** 无附加数据。由应用端下发。


#### 3.5 设置LED状态指令 -- 0x82
- **指令格式：**

| 命令字 | 协议版本 | 数据|
| --- | --- | --- |
|  0x82 | 0x01 | 0x01 |

- **数据解析：** LED状态，1：开，0：关。由应用端下发。

```
led_state  = 0x01 ; // 0x01，1， LED执行开动作。
```


#### 3.6 设置心跳周期指令 -- 0x84

- **指令格式：**

| 命令字 | 协议版本 | 数据|
| --- | --- | --- |
|  0x84 | 0x01 | 0x0A |

- **数据解析：** 心跳周期值，分钟为单位。由应用端下发。

```
heartbeat_period  = 0x0A ; // 0x0A，10， 心跳周期为 10 分钟。
```
